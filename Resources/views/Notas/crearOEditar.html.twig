{% extends 'JAMNotasFrontendBundle:Notas:layout-etiquetas-notas.html.twig' %}

{% block javascripts%}

{{ parent() }}
<script src="{{ asset('bundles/jamnotasfrontend/vendors/jquery/js/jquery-ui-1.8.17.custom.min.js') }}" type="text/javascript"></script>
<script src="{{ asset('bundles/jamnotasfrontend/vendors/CLEditor1_3_0/jquery.cleditor.min.js') }}" type="text/javascript"></script>
<script src="{{ asset('bundles/jamnotasfrontend/vendors/tagit/js/tag-it.js') }}" type="text/javascript"></script>

<script>
    $(document).ready( function() {
        $("#btn_hecho").click(function(){
            $("#form_nota").submit();
        });
        
        $("#btn_cancelar").click(function(){
            {% if edita %}
            var home = "{{ path('jamn_nota', {'id': nota_seleccionada.id}) }}";
            {% else %}
            var home = "{{ path('jamn_homepage') }}";
            {% endif %}
            window.location = home;            
        });
        
        {% if edita %}
        $("#btn_borrar").click(function(){
            $("#form_borrar").submit();
        });
        {% endif %}
        
        $("#nota_etiquetas").tagit({ 
            availableTags: [{%for etiqueta in etiquetas%} "{{ etiqueta.texto}}", {% endfor %}]                   
        });                            
               
        $("#nota_texto").cleditor({
             controls: "bold italic underline strikethrough subscript superscript | font size " +
                        "style | color highlight removeformat | bullets numbering | outdent " +
                        "indent | alignleft center alignright justify | undo redo | " +
                        "rule image link unlink | print source"
        });
   })

    </script>
{% endblock%}

{% block stylesheets %}
{{ parent() }}
    <link rel="stylesheet" type="text/css" href="{{ asset('bundles/jamnotasfrontend/vendors/CLEditor1_3_0/jquery.cleditor.css') }}" />
    <link rel="stylesheet" type="text/css" href="{{ asset('bundles/jamnotasfrontend/vendors/tagit/css/jquery.ui.autocomplete.custom.css') }}" />
    <link rel="stylesheet" type="text/css" href="{{ asset('bundles/jamnotasfrontend/vendors/tagit/css/jquery.tagit.css') }}" />

{% endblock %}


{% block detalle_y_edicion %}

<div id="confirma-borrado"></div>
<button class="btn btn-primary" id="btn_hecho"><i class="icon-check"></i> hecho</button>
<button class="btn btn-warning" id="btn_cancelar"><i class="icon-ban-circle"></i> cancelar</button>    

{%if edita %}
<button class="btn btn-danger" id="btn_borrar" type="submit"><i class="icon-remove"></i> borrar</button>
<form class="form-horizontal" id="form_borrar" action="{{ path('jamn_borrar', { 'id': nota_seleccionada.id }) }}" method="post">
    {{ form_widget(delete_form) }}
</form>
{% endif %}

{% if edita %}
<form id="form_nota" action="{{ path('jamn_editar', { 'id': nota_seleccionada.id }) }}" method="post" {{ form_enctype(form) }}>
{%else%}
<form id="form_nota" action="{{ path('jamn_nueva') }}" method="post" {{ form_enctype(form) }}>
{% endif %}
{% if form_errors(form) %}
<div class="ui-state-error">{{ form_errors(form) }}</div>
{% endif %}

<fieldset>
    {% if form_errors(form.titulo) %}
<div class="control-group error">
    <label class="control-label" for="nota_titulo">Título:</label>
    <div class="controls">
   
    {{ form_widget(form.titulo) }}
       <span class="help-inline">{{ form_errors(form.titulo) }}</span>
    </div>
     
</div>
        
   {% else %}
    <div class="control-group">
    <label class="control-label" for="nota_titulo">Título:</label>
    <div class="controls">
    {{ form_widget(form.titulo) }}
    </div>
    </div>
   {% endif %}
        
<span style="font-size: small">Etiquetas:</span>
<ul id="nota_etiquetas">
{%for etiqueta in nota_seleccionada.etiquetas %}
   <li>{{ etiqueta.texto }}</li>
{% endfor %}
</ul>

{% if form_errors(form.texto) %}
<div class="ui-state-error">{{ form_errors(form.texto) }}</div>
{% endif %}

{{ form_widget(form.texto) }}

<div style="font-size: small">Fichero:</div>
{% if nota_seleccionada.path  %}
{% set urlFile = asset( nota_seleccionada.webPath(app.user.getUsername) ) %}
<a href="{{ urlFile }}">{{ nota_seleccionada.path}}</a>
{% endif %}
{% if is_granted('ROLE_PREMIUM') %}
<div style="font-size: small">Cambiar Fichero:</div>

{% if form_errors(form.file) %}
<div class="ui-state-error">{{ form_errors(form.file) }}</div>
{% endif %}

{{ form_widget(form.file) }}
{% endif %}

{{ form_widget(form._token) }}
</form>
    
    
    



{% endblock %}